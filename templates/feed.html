{% extends "basewithjs.html" %}
{% block title %}Feed{% endblock %}
{% block head %}
<link href="{{ url_for('static', filename='CSS/feed.css') }}" rel="stylesheet">
{{ super() }}
{% endblock %}
{% block body %}
<script>
	function markArticle(articleID, markType, add) {
		const HTTPOptions = {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify({"articleID" : articleID, "markType" : markType, "add" : add})
		}
		fetch('{{ url_for("markArticleByID") }}', HTTPOptions)
	}

	function saveArticle(articleID){
		// Must be inverted because it reads the checked value BEFORE bootstrap has checked it
		itemchecked = !document.getElementById(`${articleID}-checkbox`).checked
		markArticle(articleID, "save", itemchecked)
	}

</script>
<div class="container d-none d-lg-block">
	<div id="maincarusel" class="carousel slide" data-ride="carousel">
		<div class="carousel-inner">
		{% for dictionary in detailList %}
			{% if loop.first %}
			<div class="carousel-item gallery active">
				<div class="row">
			{% elif loop.index % 2 == 1 %}
			<div class="carousel-item gallery">
				<div class="row">
				{% endif %}
					<div class="col-sm-6">
						<a {% if current_user.is_authenticated and dictionary.read %} class="read" {% endif %} href="{{ dictionary.url }}" alt="{{ dictionary.title }}" articleID="{{ dictionary.id }}" target="_blank" rel="noopener noreferrer">
							<div class="gallery-container" >
								<img src="{{ dictionary.image_url }}" class="gallery" alt="{{ dictionary.title }}" />
								<div class="desc">
									<h2>{{ dictionary.title }}</h2>
									<p>{{ dictionary.description }}</p>
								</div>
							</div>
						</a>
					</div>
				{% if loop.nextitem == undefined %}
					<div class="col-sm-6"></div>
				{% endif %}
				{% if (loop.index % 2) == 0 or loop.nextitem == undefined %}
				</div>
			</div>
			{% endif %}
		{% endfor %}
		</div>
		<button class="carousel-control-prev" type="button" data-bs-target="#maincarusel" data-bs-slide="prev">
			<span class="carousel-control-prev-icon" aria-hidden="true"></span>
			<span class="visually-hidden">Previous</span>
		</button>
		<button class="carousel-control-next" type="button" data-bs-target="#maincarusel" data-bs-slide="next">
			<span class="carousel-control-next-icon" aria-hidden="true"></span>
			<span class="visually-hidden">Next</span>
		</button>
	</div>
</div>
<div class="container p-3 my-3 border">
	{% for dictionary in detailList %}
	<div class="row">
		<div class="col-sm-12 listview-item listview-item-hoverable">
			{% if current_user.is_authenticated %}
			{% if dictionary.saved %}
			<input id="{{ dictionary.id }}-checkbox" type="checkbox" class="btn-check" autocomplete="off" checked>
			{% else %}
			<input id="{{ dictionary.id }}-checkbox" type="checkbox" class="btn-check" autocomplete="off">
			{% endif %}
			<label class="btn btn-secondary float-end listview-item-checkbutton" for="{{ dictionary.id }}-checkbox" onclick="javascript:saveArticle({{ dictionary.id }})">Save Article</label>
			{% endif %}
			<a {% if current_user.is_authenticated and dictionary.read %} class="read" {% endif %} href="{{ dictionary.url }}" articleID="{{ dictionary.id }}" target="_blank" rel="noopener noreferrer">
				<div style="min-height: 202px;" class="border border-1 rounded">
					<img src="{{ dictionary.image_url }}" class="img-thumbnail thumbnail cover rounded float-start border-0 d-none d-sm-block" alt="{{ dictionary.title }}" />
					<img src="{{ dictionary.image_url }}" class="thumbnail w-100 rounded float-start border-0 d-block d-sm-none" alt="{{ dictionary.title }}" />
					<h2>{{ dictionary.title }}</h2>
					<p class="source">Author: {{ dictionary.author }} - Publisher: {{ dictionary.profile }} - Published: {{ dictionary.publish_date }}</p>
					<p class="description">{{ dictionary.description }}</p>
				</div>
			</a>
		</div>
	</div>
	{% endfor %}
</div>

{% if current_user.is_authenticated %}
	<script src="{{ url_for('static', filename='JS/trackLinks.js') }}"></script>
{% endif %}

{% endblock %}
